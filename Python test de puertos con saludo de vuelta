import socket
import threading
import tkinter as tk
from tkinter import messagebox

server_socket = None
listening = False

def start_listening():
    global server_socket, listening
    try:
        port = int(port_entry.get())
        server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        server_socket.bind(("", port))
        server_socket.listen(5)
        listening = True
        status_label.config(text="Escuchando en puerto " + str(port))
        threading.Thread(target=accept_connections, daemon=True).start()
    except Exception as e:
        messagebox.showerror("Error", str(e))

def accept_connections():
    global listening
    while listening:
        try:
            client_socket, addr = server_socket.accept()
            print(f"Conexi√≥n desde: {addr}")

            #  Respuesta
            mensaje = "Hola, el puerto esta abierto.\r\n"
            client_socket.send(mensaje.encode())

            client_socket.close()

        except:
            break

def stop_listening():
    global server_socket, listening
    listening = False
    if server_socket:
        server_socket.close()
    status_label.config(text="Detenido")

# --- GUI ---
root = tk.Tk()
root.title("Puerto Listener")

tk.Label(root, text="Puerto:").pack()
port_entry = tk.Entry(root)
port_entry.pack()
port_entry.insert(0,"1438")

tk.Button(root, text="Play", command=start_listening).pack()
tk.Button(root, text="Stop", command=stop_listening).pack()
status_label = tk.Label(root, text="Detenido")
status_label.pack()

root.mainloop()
